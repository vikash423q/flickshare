chrome.runtime.onInstalled.addListener(()=>{console.log("FlickCall Clone extension installed")});chrome.runtime.onMessage.addListener((e,n,a)=>{if(console.log("Background received message:",e),e.action==="joinParty"){console.log("Listening for tab load to join party...");const{tabId:o,roomId:t}=e,s=(i,c,d)=>{i===o&&c.status==="complete"&&(console.log("Tab finished loading, injecting panel..."),chrome.scripting.executeScript({target:{tabId:o},files:["assets/index.jsx-loader.js"]}).then(()=>{console.log("Loader injected, waiting for contentReady...");const r=l=>{l.action==="contentReady"&&(console.log("Content ready, opening panel..."),chrome.tabs.sendMessage(o,{action:"openPanel",roomId:t}),chrome.runtime.onMessage.removeListener(r))};chrome.runtime.onMessage.addListener(r)}),chrome.tabs.onUpdated.removeListener(s))};return chrome.tabs.onUpdated.addListener(s),a({success:!0}),!0}});chrome.tabs.onUpdated.addListener((e,n,a)=>{n.status==="complete"&&chrome.storage.local.get([`panelState_${e}`],o=>{const t=o[`panelState_${e}`];t&&t.isOpen&&chrome.tabs.sendMessage(e,{action:"restorePanel"},()=>{chrome.runtime.lastError})})});chrome.tabs.onRemoved.addListener(e=>{chrome.storage.local.remove(`panelState_${e}`)});
