class n{constructor(){this.player=document.querySelector("video"),this.stateSubscribers=new Set,this.stateCheckInterval=null,this.lastDateTime=this.getDateTime(),this.lastState=null,this.retryInterval=2,this.init()}getDateTime(){return new Date().getTime()/1e3}init(){const e=()=>{this.player=document.querySelector("video"),this.player?console.log("ðŸŽ¬ Video player found"):this.retryCount<100?(this.retryCount++,console.log(`â³ Player not found, retrying (${this.retryCount}/${this.maxRetries})...`),setTimeout(e,this.retryInterval)):console.warn("âš ï¸ Failed to find video player after max retries")};e()}play(){this.isLoaded()&&this.player.play()}pause(){this.isLoaded()&&this.player.pause()}togglePlayPause(){this.isLoaded()&&(this.isPlaying()?this.pause():this.play())}seek(e){this.isLoaded()&&(this.player.currentTime=e)}isLoaded(){return!!this.player}isPlaying(){return this.isLoaded()&&!this.player.paused&&!this.player.ended}getCurrentTime(){return this.isLoaded()?this.player.currentTime:0}getDuration(){return this.isLoaded()?this.player.duration:0}getPlaybackRate(){return this.isLoaded()?this.player.playbackRate:1}setPlaybackRate(e){this.isLoaded()&&(this.player.playbackRate=e)}getVolume(){return this.isLoaded()?this.player.volume:0}setVolume(e){this.isLoaded()&&(this.player.volume=e)}getState(){return{isPlaying:this.isPlaying(),duration:this.getDuration(),currentTime:this.getCurrentTime(),playbackRate:this.getPlaybackRate(),volume:this.getVolume(),isLoaded:this.isLoaded()}}subscribe(e,t={}){const s=t.pollInterval||500;if(!this.isLoaded()){console.warn("Player not loaded yet. Waiting...");const r=setInterval(()=>{this.isLoaded()&&(clearInterval(r),this.subscribe(e,t))},100);return()=>clearInterval(r)}return this.stateSubscribers.add(e),this.stateCheckInterval||this._startStatePolling(s),e(this.getState()),()=>this.unsubscribe(e)}unsubscribe(e){this.stateSubscribers.delete(e),this.stateSubscribers.size===0&&this._stopStatePolling()}unsubscribeAll(){this.stateSubscribers.clear(),this._stopStatePolling()}_startStatePolling(e){this.stateCheckInterval=setInterval(()=>{const t=this.getState();this._hasStateChanged(t)&&(this.stateSubscribers.forEach(s=>{s(t)}),this.lastState=t,this.lastDateTime=this.getDateTime())},e)}_stopStatePolling(){this.stateCheckInterval&&(clearInterval(this.stateCheckInterval),this.stateCheckInterval=null,this.lastState=null)}_hasStateChanged(e){if(!this.lastState||e.isPlaying!==this.lastState.isPlaying)return!0;const t=this.getDateTime()-this.lastDateTime,s=e.currentTime-this.lastState.currentTime;return!!(e.isPlaying&&Math.abs(t-s)>.1)}destroy(){this.unsubscribeAll()}}class h extends n{constructor(){super()}}class c extends n{constructor(){super(),this.observePlayer()}observePlayer(){const e=()=>{const s=document.querySelector("video");if(s&&s!==this.player){this.player=s;const r=this.getState();this.stateSubscribers.forEach(a=>a(r))}};e(),new MutationObserver(e).observe(document.body,{childList:!0,subtree:!0})}}class d extends n{constructor(){super(),this.initNetflixPlayer()}initNetflixPlayer(e=10){try{const t=window.netflix?.appContext?.state?.playerApp?.getAPI()?.videoPlayer;if(!t)throw new Error("Netflix player not ready");const s=t.getAllPlayerSessionIds()[0];if(!s)throw new Error("No session found");this.player=t.getVideoPlayerBySessionId(s)}catch(t){e>0?(console.warn("Retrying Netflix player init...",t),setTimeout(()=>this.initNetflixPlayer(e-1),1e3)):console.error("Failed to initialize Netflix player:",t)}}isLoaded(){return!!this.player}isPlaying(){try{return this.isLoaded()&&this.player.isPlaying()}catch{return!1}}play(){try{this.media.play()}catch(e){console.error("Netflix play failed:",e)}}pause(){try{this.media.pause()}catch(e){console.error("Netflix pause failed:",e)}}seek(e){try{const t=e/this.getDuration(),s=document.querySelector('[data-uia="timeline-knob"]');if(!s)return;const r=s.getBoundingClientRect(),a=s.parentElement,o=a.getBoundingClientRect(),l=o.left+o.width*t;a.dispatchEvent(new MouseEvent("mousedown",{bubbles:!0,clientX:r.x})),a.dispatchEvent(new MouseEvent("mousemove",{bubbles:!0,clientX:l})),a.dispatchEvent(new MouseEvent("mouseup",{bubbles:!0,clientX:l}))}catch(t){console.error("Netflix seek failed:",t)}}getCurrentTime(){try{return this.player.getCurrentTime()/1e3}catch{return 0}}getDuration(){try{return this.player.getDuration()/1e3}catch{return 0}}}const u={"youtube.com":h,"netflix.com":d,"primevideo.com":c},y=()=>{const i=window.location.hostname;for(const e in u)if(i.includes(e))return new u[e];return console.warn("No supported site found for:",i),new n};export{y as default,u as supportedSites};
